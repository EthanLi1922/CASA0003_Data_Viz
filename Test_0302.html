<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Mapbox Example 7- Tube map background</title>
	<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
	<link href="https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.css" rel="stylesheet">
	<script src="https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.js"></script>
	<!-- 引入CSS文件 -->
	<link href='Mapbox_example9_styles.css' rel='stylesheet' />


	<style>
		body {
			margin: 0;
			padding: 0;
		}

		#map {
			position: absolute;
			top: 0;
			bottom: 0;
			width: 100%;
		}

		;
	</style>
</head>


<body>
	<div id="map"></div>
	<!-- class='map-overlay top' 指定了该容器的类名为 map-overlay，并且添加了 top 类。这些类用于指定样式和定位。 -->
	<div class='map-overlay top'>
		<!-- 内嵌的 <div> 元素，用于创建容器的内部内容。 -->
		<div class='map-overlay-inner'>
			<h2>Worldwide Unempolyment Rate</h2>
			<table>
				<tr>
					<td>
						<!-- <input> 元素，创建了一个滑动条输入框。 -->
						<input id='slider' type='range' min='0' max='14' step='1' value='0' list='tickmarks' />
						<datalist id="tickmarks">
							<option value="0" label="2008">
							<option value="1">
							<option value="2">
							<option value="3">
							<option value="4">
							<option value="5">
							<option value="6" label="2014">
							<option value="7">
							<option value="8">
							<option value="9">
							<option value="10">
							<option value="11">
							<option value="12">
							<option value="13">
							<option value="14">
							<option value="14" label="2022">
						</datalist>
					</td>
					<td>
						<label id='year'>2008</label>
					</td>
				</tr>
			</table>
			<p class="credit">Passenger data: <a href="http://crowding.data.tfl.gov.uk/">TfL</a>. Line and Station data: <a
					href="https://github.com/oobrien/vis/tree/master/tube/data">Oliver O'Brien</a></p>
		</div>
	</div>



	<script>
		mapboxgl.accessToken = 'pk.eyJ1IjoibHljMTk5OTExMTEiLCJhIjoiY2t0bjMzN2xkMmMwMzJ2cWZueXZzZHN0ZSJ9.BQGI-sCp3fhGZSD8NTeFtw';  //Put your mapbox access token here

		// Load a new map in the 'map' HTML div
		var map = new mapboxgl.Map({
			container: 'map', // container id
			style: 'mapbox://styles/lyc19991111/clt9agfm6015201quakw5d2zx', // Put your mapbox style ID here
			center: [-0.1, 51.5], // starting position [lng, lat]
			zoom: 1 // starting zoom
		});

		// Create an array of the available data years
		var years = [
			'2008',
			'2009',
			'2010',
			'2011',
			'2012',
			'2013',
			'2014',
			'2015',
			'2016',
			'2017',
			'2018',
			'2019',
			'2020',
			'2021',
			'2022'
		];

		// 这是一个地图加载完成后的回调函数，意味着地图已经准备好进行交互和操作。
			map.on('load', function () {


				// This is the main function that runs when the user changes the data year
				// 定义了一个名为 setYear 的函数，用于根据用户选择的年份更新地图上的数据。该函数接受一个 year 参数，代表用户选择的年份。
				function setYear(year) {

					// 通过 getElementById 方法获取具有 id 属性为 'year' 的元素，并将其文本内容设置为 years[year]，即用户选择的年份。
					document.getElementById('year').textContent = years[year];
					// Set the label to the correct year

					// 获取名为 'TubeEntryExit2' 的图层上的 circle - radius 属性，并将其值存储在变量 pp 中。
					var pp = map.getPaintProperty('TubeEntryExit2', 'circle-radius');

					// 根据用户选择的年份更新 pp 变量的 property 属性为 EE 加上用户选择的年份。
					console.log(pp);
					pp.property = "EE" + years[year];
					// update the pp circle-radius to the new column set by the user

					// 将更新后的 pp 对象作为 'TubeEntryExit2' 图层的 circle - radius 属性的值进行设置，从而更新地图上的圆圈半径。
					map.setPaintProperty('TubeEntryExit2', 'circle-radius', pp);

					console.log(map.getPaintProperty('TubeEntryExit2', 'circle-radius'));

					// 构建一个名为 yearcol 的字符串，表示用户选择的年份对应的数据列。
					var yearcol = "EE" + String(years[year]);
					// 构建一个名为 textfield 的字符串，表示地图上标签的文本字段，以 yearcol 为数据列，加上单位 m。
					var textfield = "{" + yearcol + "}m";

					console.log(textfield);

					// 更新地图上标签图层的文本字段为 textfield。
					map.setLayoutProperty('labels', 'text-field', textfield); // update the labels layer to the new column
					var filters = ['>', yearcol, 30];
					map.setFilter('labels', filters);
				}

				// Assign an event listner to the slider so that the setYear function runs when the user changes the slider
				// 为滑动条分配一个事件监听器，以便在用户更改滑动条时运行setYear函数

				// ！！！拖动滑块时让年份变化
				document.getElementById('slider').addEventListener('input', function (e) {
					var year = parseInt(e.target.value);
					setYear(year);
				});

				var mypopup = new mapboxgl.Popup({ offset: [150, 50], closeButton: false });

				});


	</script>

</body>

</html>