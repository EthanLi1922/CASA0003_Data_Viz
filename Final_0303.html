<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Mapbox Example 7- Tube map background</title>
	<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
	<link href="https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.css" rel="stylesheet">
	<script src="https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.js"></script>
	<!-- 引入CSS文件 -->
	<link href='Mapbox_example9_styles.css' rel='stylesheet' />


	<style>
		body {
			margin: 0;
			padding: 0;
		}

		#map {
			position: absolute;
			top: 0;
			bottom: 0;
			width: 100%;
		}

		;
	</style>
</head>


<body>
	<div id="map"></div>
	<!-- class='map-overlay top' 指定了该容器的类名为 map-overlay，并且添加了 top 类。这些类用于指定样式和定位。 -->
	<div class='map-overlay top'>
		<!-- 内嵌的 <div> 元素，用于创建容器的内部内容。 -->
		<div class='map-overlay-inner'>
			<h2>Worldwide Unempolyment Rate</h2>
			<table>
				<tr>
					<td>
						<!-- <input> 元素，创建了一个滑动条输入框。 -->
						<input id='slider' type='range' min='0' max='25' step='1' value='0' list='tickmarks' />
						<datalist id="tickmarks">
							<option value="0" label="2000">
							<option value="1">
							<option value="2">
							<option value="3">
							<option value="4">
							<option value="5"  label="2005">
							<option value="6">
							<option value="7">
							<option value="8">
							<option value="9">
							<option value="10" label="2010">
							<option value="11">
							<option value="12">
							<option value="13">
							<option value="14">
							<option value="15" label="2015">
							<option value="16">
							<option value="17">
							<option value="18">
							<option value="19">
							<option value="20" label="2020">
							<option value="21">
							<option value="22">
							<option value="23">
							<option value="24">
							<option value="25" label="2025">
						</datalist>
					</td>
					<td>
						<label id='year'>2000</label>
					</td>
				</tr>
			</table>
			<p class="credit">Passenger data: <a href="http://crowding.data.tfl.gov.uk/">TfL</a>. Line and Station data: <a
					href="https://github.com/oobrien/vis/tree/master/tube/data">Oliver O'Brien</a></p>
		</div>
	</div>



	<script>
		// Add accessToken
		mapboxgl.accessToken = 'pk.eyJ1IjoibHljMTk5OTExMTEiLCJhIjoiY2t0bjMzN2xkMmMwMzJ2cWZueXZzZHN0ZSJ9.BQGI-sCp3fhGZSD8NTeFtw';  //Put your mapbox access token here

		// Load a new map in the 'map' HTML div
		var map = new mapboxgl.Map({
			container: 'map', // container id
			style: 'mapbox://styles/lyc19991111/cltaoiowe00g501qn2m2ifij6', // Put your mapbox style ID here
			center: [-0.1, 51.5], // starting position [lng, lat]
			zoom: 1 // starting zoom
		});

		// Create an array of the available data years
			var years = [
				'2000','2001','2002','2003','2004','2005','2006','2007','2008','2009',
				'2010','2011','2012','2013','2014','2015','2016','2017','2018','2019',
				'2020','2021','2022', '2023', '2024', '2025',
			];



	    map.on('load', function () {

			// 在这里定义 fillColorExpression，以确保在 map.addLayer 调用时它是可用的
			var fillColorExpression = [
				'interpolate',
				['linear'],
				['get', 'WUR2000'], // 这是一个初始属性，稍后会在 setYear 函数中动态更新
				0, '#053061',
				2, '#053061',
				4, '#2065ab',
				6, '#4393c3',
				8, '#90c4dd',
				10, '#d1e5f0',
				12, '#f7f6f6',
				14, '#f9ede5',
				16, '#fbe3d4',
				18, '#fcd7c2',
				20, '#f9c4a9',
				24, '#f09c7b',
				28, '#da6853',
				32, '#c13639',
				36, '#9c1127',
				40, '#67001f',
				10000, '#c7c7c7'
			];

			

			// 使用 map.getStyle().layers 检查图层的顺序
			var layers = map.getStyle().layers;
			var layerId;
			for (var i = 0; i < layers.length; i++) {
				if (layers[i].id === 'FINAL_DATASET') {
					layerId = layers[i].id;
					break;
				}
			}

			// 在 'FINAL_DATASET' 图层下面添加您的新图层 'JustaNAme'
			map.addLayer({
				id: 'JustaName',
				type: 'fill',
				source: {
					type: 'vector',
					url: 'mapbox://lyc19991111.5flmdelq'
				},
				'source-layer': 'Final_01-2qxwjk',
				'layout': {
					'visibility': 'visible'
				},
				'paint': {
					'fill-color': fillColorExpression,
					'fill-opacity': 0.95
				}
			}, layerId); // 指定在 'FINAL_DATASET' 下面添加图层

			

			function setYear(yearIndex) {
				// 获取年份值
				var year = years[yearIndex];
				document.getElementById('year').textContent = year; // 更新年份显示

				// 根据当前年份构建数据属性名
				var dataProperty = 'WUR' + year;

				// 构建 fillColorExpression 用于动态更新 'fill-color' 样式
				var fillColorExpression = [
					'interpolate',
					['linear'],
					['get', dataProperty], // 使用动态属性名
					// ...颜色插值
					// ...省略其他颜色值，以简化示例
					0, '#053061',
					2, '#053061',
					4, '#2065ab',
					6, '#4393c3',
					8, '#90c4dd',
					10, '#d1e5f0',
					12, '#f7f6f6',
					14, '#f9ede5',
					16, '#fbe3d4',
					18, '#fcd7c2',
					20, '#f9c4a9',
					24, '#f09c7b',
					28, '#da6853',
					32, '#c13639',
					36, '#9c1127',
					40, '#67001f',
					10000, '#c7c7c7'
				];


				// ...更新 fillColorExpression 的代码
				map.setPaintProperty('JustaName', 'fill-color', fillColorExpression);
			}








		// 添加滑动条的事件监听器
		document.getElementById('slider').addEventListener('input', function (e) {
			var yearIndex = parseInt(e.target.value); // 滑动条提供年份的索引
			setYear(yearIndex); // 调用 setYear 并传递年份的索引
		});
	});



	


	</script>

</body>

</html>